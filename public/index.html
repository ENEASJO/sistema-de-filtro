<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Filtro - Validaci√≥n de RUCs</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Cambiar tema">
        <span class="theme-toggle-icon">üåô</span>
    </button>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üîç Sistema de Filtro</h1>
            <p class="subtitle">Validaci√≥n de RUCs y Detecci√≥n de Familiares</p>
        </header>

        <!-- OCR General Section -->
        <div class="ocr-general-section" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
            <h2 style="margin: 0 0 10px 0; color: white; font-size: 1.3rem;">üì∑ Extracci√≥n Autom√°tica OCR</h2>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px; font-size: 0.9rem;">
                Suba im√°genes que contengan DNIs o RUCs. El sistema detectar√° y clasificar√° autom√°ticamente cada n√∫mero.
            </p>

            <input type="file" id="image-input-general" accept="image/*" multiple style="display: none;">
            <button type="button" id="upload-image-btn-general" class="btn" style="width: 100%; background: white; color: #667eea; font-weight: 600; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                üì§ Subir Im√°genes para Extraer DNIs y RUCs
            </button>

            <!-- Image Preview -->
            <div id="preview-container-general" style="display: none; margin-top: 15px;">
                <div id="preview-grid-general" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;"></div>
            </div>

            <!-- OCR Progress -->
            <div id="ocr-loader-general" style="display: none; margin-top: 15px; text-align: center;">
                <div style="margin-bottom: 10px;">
                    <div style="width: 100%; height: 8px; background: rgba(255,255,255,0.3); border-radius: 4px; overflow: hidden;">
                        <div id="ocr-progress-general" style="width: 0%; height: 100%; background: white; transition: width 0.3s;"></div>
                    </div>
                </div>
                <p id="ocr-progress-text-general" style="color: white; font-size: 0.9rem; margin: 0;">Procesando imagen...</p>
            </div>

            <!-- Results Summary -->
            <div id="ocr-results-summary" style="display: none; margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.95); border-radius: 8px; color: #1e293b;">
                <div style="display: flex; justify-content: space-around; text-align: center;">
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;" id="dnis-count">0</div>
                        <div style="font-size: 0.85rem; color: #64748b;">DNIs Extra√≠dos</div>
                    </div>
                    <div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #3b82f6;" id="rucs-count">0</div>
                        <div style="font-size: 0.85rem; color: #64748b;">RUCs Extra√≠dos</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="individual">RUC Individual</button>
            <button class="tab-btn" data-tab="batch">B√∫squeda Masiva</button>
            <button class="tab-btn" data-tab="comparar">Comparar DNIs</button>
        </div>

        <!-- Tab Content: Individual -->
        <div id="individual-tab" class="tab-content active">
            <div class="search-box">
                <h2>Buscar RUC Individual</h2>
                <form id="form-individual">
                    <div class="input-group">
                        <input
                            type="text"
                            id="ruc-input"
                            placeholder="Ingrese RUC (11 d√≠gitos)"
                            maxlength="11"
                            pattern="\d{11}"
                            required
                        >
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-text">Buscar</span>
                            <span class="btn-loader" style="display: none;">Buscando...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Resultado Individual -->
            <div id="resultado-individual" class="resultado" style="display: none;">
                <!-- El contenido se genera din√°micamente -->
            </div>
        </div>

        <!-- Tab Content: Batch -->
        <div id="batch-tab" class="tab-content">
            <div class="search-box">
                <h2>B√∫squeda Masiva de RUCs</h2>
                <form id="form-batch">
                    <div class="input-group-vertical">
                        <label for="rucs-input">Ingrese RUCs (uno por l√≠nea)</label>
                        <textarea
                            id="rucs-input"
                            placeholder="20123456789&#10;10987654321&#10;20555666777"
                            rows="8"
                            required
                        ></textarea>
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-text">Procesar RUCs</span>
                            <span class="btn-loader" style="display: none;">Procesando...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Resultado Batch -->
            <div id="resultado-batch" class="resultado" style="display: none;">
                <!-- El contenido se genera din√°micamente -->
            </div>
        </div>

        <!-- Tab Content: Comparar DNIs -->
        <div id="comparar-tab" class="tab-content">
            <div class="search-box">
                <h2>üîó Comparar DNIs y Detectar V√≠nculos Familiares</h2>
                <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">
                    Ingrese m√∫ltiples DNIs para verificar si existen v√≠nculos familiares entre ellos.
                    <strong>No se realiza scraping</strong>, solo se comparan los DNIs ingresados.
                </p>

                <form id="form-comparar">
                    <div class="input-group-vertical">
                        <label for="dnis-input">Ingrese DNIs (uno por l√≠nea, m√≠nimo 2 DNIs)</label>
                        <textarea
                            id="dnis-input"
                            placeholder="12345678&#10;87654321&#10;11223344&#10;55667788"
                            rows="10"
                            required
                        ></textarea>
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-text">üîç Comparar DNIs</span>
                            <span class="btn-loader" style="display: none;">Comparando...</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Resultado Comparar -->
            <div id="resultado-comparar" class="resultado" style="display: none;">
                <!-- El contenido se genera din√°micamente -->
            </div>
        </div>

        <!-- Alert Messages -->
        <div id="alert-container"></div>
    </div>

    <!-- Footer -->
    <footer>
        <p>
            Desarrollado por <strong>JOEL VERAMENDI</strong> ¬© 2025
        </p>
    </footer>

    <script>
        // Theme Toggle - Cargar tema guardado inmediatamente
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);

            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = themeToggle.querySelector('.theme-toggle-icon');

            // Actualizar icono inicial
            themeIcon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            // Toggle theme
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            });
        })();
    </script>
    <script src="/js/ocr-mejorado.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
